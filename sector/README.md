# 新的规划

## 实验了wiki2vec & attention memnet based sector

### 首先作为baseline的2:2 & 0 memsize
1. epoch = 0时候f1为0.51左右，还没有训练好
2. epoch = 4左右f1回升到0.76, 算是正常水准
3. 2：2比1：1效果要差，这是为何？

### 1:1 & memsize = 5效果正常水准
### 2:2 & memsize = 5效果正常水准
### 2:2 & memsize = 2效果正常水准

## 试验了双层sentence compressor & 双层sentence integrator

性能不升反降


## 对分割进行分析

使用方法:

```py
from wikiattmem import *
import utils_lite as U
m = AttMemNet(head = 6, memory_size = 0)
inpts = labels = None # Get inpts & labels by yourself
o, sentence_scores, word_scores_per_sentence, memory_info = m.dry_run(inpts, labels, checking = True)
pos = 0 # Sentence index
U.draw_head_attention(word_scores_per_sentence[pos], memory_info[pos], path='out.png')
```

![heatmap](out.png)


## 实验记录

现在池化模型精度应该是最高的，以这个实验为基点，进行探索分析

```
# 没有FL
## TODO: BASELINE 1:2
## BASELINE 1:1
# TEST
{'prec': 0.911746, 'rec': 0.734601, 'f1': 0.813643, 'bacc': 0.859621}
{'prec': 0.975086, 'rec': 0.705558, 'f1': 0.818710, 'bacc': 0.850832}
{'prec': 0.946954, 'rec': 0.724086, 'f1': 0.820658, 'bacc': 0.857662}
{'prec': 0.946856, 'rec': 0.731597, 'f1': 0.825423, 'bacc': 0.861363}
{'prec': 0.946989, 'rec': 0.724586, 'f1': 0.820992, 'bacc': 0.857912}

# DEV
{'prec': 0.779951, 'rec': 0.471196, 'f1': 0.587476, 'bacc': 0.725317}
{'prec': 0.849397, 'rec': 0.416543, 'f1': 0.558969, 'bacc': 0.702560}
{'prec': 0.788659, 'rec': 0.451994, 'f1': 0.574647, 'bacc': 0.716629}
{'prec': 0.780722, 'rec': 0.478581, 'f1': 0.593406, 'bacc': 0.728895}
{'prec': 0.824289, 'rec': 0.471196, 'f1': 0.599624, 'bacc': 0.727830}
## 池化1:2
{
  "testdic": {
    "prec": 0.9283935242839353,
    "rec": 0.7462462462462462,
    "f1": 0.8274139844617093,
    "bacc": 0.8669035449727716
  },
  "devdic": {
    "prec": 0.724669603524229,
    "rec": 0.48525073746312686,
    "f1": 0.5812720848056536,
    "bacc": 0.7283461820740355
  },
  "desc": "池化epoch压测: epoch2"
}
{
  "testdic": {
    "prec": 0.8866513233601842,
    "rec": 0.7712712712712713,
    "f1": 0.8249464668094219,
    "bacc": 0.8749812278476421
  },
  "devdic": {
    "prec": 0.6624775583482945,
    "rec": 0.5442477876106194,
    "f1": 0.5975708502024292,
    "bacc": 0.7506479970723876
  },
  "desc": "试着池化, 跑四次，每次2epoch"
}
{
  "testdic": {
    "prec": 0.9224190592547342,
    "rec": 0.7557557557557557,
    "f1": 0.8308115543328747,
    "bacc": 0.8710093002683592
  },
  "devdic": {
    "prec": 0.7325842696629213,
    "rec": 0.4808259587020649,
    "f1": 0.5805877114870882,
    "bacc": 0.7268191936530658
  },
  "desc": "试着池化, 跑四次，每次2epoch"
}
{
  "testdic": {
    "prec": 0.9159049360146252,
    "rec": 0.7522522522522522,
    "f1": 0.8260511129431162,
    "bacc": 0.8686626323457043
  },
  "devdic": {
    "prec": 0.7213822894168467,
    "rec": 0.49262536873156343,
    "f1": 0.5854513584574934,
    "bacc": 0.7315765637352128
  },
  "desc": "试着池化, 跑四次，每次2epoch"
}
{
  "testdic": {
    "prec": 0.8720800889877642,
    "rec": 0.7847847847847848,
    "f1": 0.8261327713382508,
    "bacc": 0.8799532360916893
  },
  "devdic": {
    "prec": 0.6296296296296297,
    "rec": 0.551622418879056,
    "f1": 0.5880503144654089,
    "bacc": 0.7506798409222788
  },
  "desc": "试着池化, 跑四次，每次2epoch"
}

# FL
# Baseline 1:1
{
  "testdic": {
    "prec": 0.8991596638655462,
    "rec": 0.7497497497497497,
    "f1": 0.8176855895196506,
    "bacc": 0.8657888824465352
  },
  "devdic": {
    "prec": 0.6678635547576302,
    "rec": 0.5486725663716814,
    "f1": 0.6024291497975708,
    "bacc": 0.7532030869326993
  },
  "desc": "BASELINE rate = 5"
}
{
  "testdic": {
    "prec": 0.9420476497102382,
    "rec": 0.7322322322322322,
    "f1": 0.8239932413404675,
    "bacc": 0.8612486201723628
  },
  "devdic": {
    "prec": 0.7858880778588808,
    "rec": 0.47640117994100295,
    "f1": 0.593204775022957,
    "bacc": 0.7281480425636018
  },
  "desc": "BASELINE rate = 5"
}
{
  "testdic": {
    "prec": 0.9563780568407139,
    "rec": 0.7242242242242243,
    "f1": 0.8242665907148962,
    "bacc": 0.858542615086693
  },
  "devdic": {
    "prec": 0.8136020151133502,
    "rec": 0.47640117994100295,
    "f1": 0.6009302325581396,
    "bacc": 0.729747311469245
  },
  "desc": "BASELINE rate = 5"
}
## 2:2
{
  "testdic": {
    "prec": 0.8981481481481481,
    "rec": 0.7282282282282282,
    "f1": 0.8043117744610282,
    "bacc": 0.8551903715505662
  },
  "devdic": {
    "prec": 0.7600950118764845,
    "rec": 0.471976401179941,
    "f1": 0.5823475887170154,
    "bacc": 0.7244506177706879
  },
  "desc": "加大长度2:2 rate = 5"
}
{
  "testdic": {
    "prec": 0.8376731301939058,
    "rec": 0.7567567567567568,
    "f1": 0.7951617144359716,
    "bacc": 0.8625319749170479
  },
  "devdic": {
    "prec": 0.7024291497975709,
    "rec": 0.5117994100294986,
    "f1": 0.5921501706484642,
    "bacc": 0.7391073815054964
  },
  "desc": "加大长度2:2 rate = 5"
}
{
  "testdic": {
    "prec": 0.8977884040645547,
    "rec": 0.7517517517517518,
    "f1": 0.8183056387905203,
    "bacc": 0.8666276335827445
  },
  "devdic": {
    "prec": 0.7450980392156863,
    "rec": 0.504424778761062,
    "f1": 0.6015831134564643,
    "bacc": 0.7388470706690848
  },
  "desc": "加大长度2:2 rate = 5"
}
## 1:1 rate = 6
{
  "testdic": {
    "prec": 0.9344262295081968,
    "rec": 0.7417417417417418,
    "f1": 0.8270089285714286,
    "bacc": 0.8652462088914226
  },
  "devdic": {
    "prec": 0.7391304347826086,
    "rec": 0.5014749262536873,
    "f1": 0.5975395430579964,
    "bacc": 0.7370294439356168
  },
  "desc": "1:1但是提升衰减率rate = 6"
}

```


